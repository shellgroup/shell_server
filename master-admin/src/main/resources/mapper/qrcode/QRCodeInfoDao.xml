<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.winnerdt.modules.qrcode.dao.QRCodeInfoDao">
    <resultMap id="shoppersCodeMap" type="com.winnerdt.modules.qrcode.entity.QRCodeInfoEntity">
        <id property="id" column="id"/>
        <result property="mallType" column="mall_type"/>
        <result property="mallCode" column="mall_code"/>
        <result property="mallName" column="mall_name"/>
        <result property="deptName" column="dept_name"/>
        <result property="deptId" column="dept_id"/>
        <result property="userId" column="user_id"/>
        <result property="userName" column="user_name"/>
        <result property="userPhone" column="user_phone"/>
        <result property="imgPath" column="img_path"/>
        <result property="imgName" column="img_name"/>
        <result property="imgTime" column="img_time"/>
        <result property="wxAppinfoId" column="wx_appinfo_id"/>
        <result property="qrcodeConfigId" column="qrcode_config_id"/>
        <result property="isCreateQrcode" column="is_create_qrcode"/>
        <result property="enterpriseId" column="enterprise_id"/>
        <result property="enterpriseName" column="enterprise_name"/>
        <result property="isDel" column="is_del"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <collection property="qrCodeConfigEntity" ofType="com.winnerdt.modules.qrcode.entity.QRCodeConfigEntity">
            <id property="id" column="qcId"/>
            <result property="qrcodeHeight" column="qcQrcodeHeight" />
            <result property="qrcodeWidth" column="qcQrcodeWidth" />
            <result property="qrcodeFontSize" column="qcQrcodeFontSize"/>
            <result property="qrcodeFontHeight" column="qcQrcodeFontHeight" />
            <result property="qrcodeIndexUrl" column="qcQrcodeIndexUrl"/>
            <result property="qrcodePath" column="qcQrcodePath"/>
            <result property="isDel" column="qcIsDel"/>
            <result property="qrcodeConfigName" column="qcQrcodeConfigName"/>
            <result property="remark" column="qcRemark"/>
            <result property="createTime" column="qcCreateTime"/>
            <result property="updateTime" column="qcUpdateTime"/>
        </collection>
        <collection property="wxAppinfoEntity" ofType="com.winnerdt.modules.qrcode.entity.WxAppinfoEntity">
            <id property="id" column="waId"/>
            <result property="appid" column="waAppid"/>
            <result property="secret" column="waSecret"/>
            <result property="name" column="waName"/>
            <result property="token" column="waToken"/>
            <result property="aeskey" column="waAeskey"/>
            <result property="accessToken" column="waAccessToken"/>
            <result property="lastTokenTime" column="waLastTokenTime"/>
            <result property="expiresIn" column="waEpiresIn"/>
            <result property="remark" column="waRemark"/>
        </collection>
    </resultMap>

    <select id="queryShoppersCodeListPage" resultMap="shoppersCodeMap">
        SELECT sc1.*
        ,qc.id qcId,qc.qrcode_height qcQrcodeHeight,qc.qrcode_width qcQrcodeWidth,qc.qrcode_font_size qcQrcodeFontSize,qc.qrcode_font_height qcQrcodeFontHeight,qc.qrcode_index_url qcQrcodeIndexUrl
        ,qc.qrcode_path qcQrcodePath,qc.is_del qcIsDel,qc.qrcode_config_name qcQrcodeConfigName,qc.remark qcRemark,qc.create_time qcCreateTime,qc.update_time qcUpdateTime
        ,wa.id waId,wa.appid waAppid,wa.secret waSecret,wa.name waName,wa.token waToken,wa.aeskey waAeskey,wa.access_token waAccessToken,wa.last_token_time waLastTokenTime,wa.expires_in waExpiresIn,wa.remark waRemark
        from (
            SELECT * FROM `shoppers_code` sc
            <where>
                <if test="userName != null and userName != ''">
                    and sc.user_name LIKE concat('%',#{userName},'%')
                </if>
                <if test="mallType != null and mallType != ''">
                    and sc.mall_type LIKE concat('%',#{mallType},'%')
                </if>
                <if test="mallCode != null and mallCode != ''">
                    and sc.mall_code like concat('%',#{mallCode},'%')
                </if>
                <if test="deptName != null and deptName != ''">
                    and sc.dept_name like concat('%',#{deptName},'%')
                </if>
                <if test="userId != null and userId != ''">
                    and sc.user_id like concat('%',#{userId},'%')
                </if>
                <if test="userName != null  and userName != ''">
                    and sc.user_name like concat('%',#{userName},'%')
                </if>
                <if test="userPhone != null and userPhone != ''">
                    and sc.user_phone like concat('%',#{userPhone},'%')
                </if>
                <if test="imgBeginTime != null and imgBeginTime != '' and imgEndTime != null and imgEndTime != ''">
                    and sc.img_time between #{imgBeginTime} and #{imgEndTime}
                </if>
                <if test="enterpriseName != null and enterpriseName != ''">
                    and sc.enterprise_name like concat('%',#{enterpriseName},'%')
                </if>
                <if test="createBeginTime != null and createBeginTime != '' and createEndTime != null and createEndTime != ''">
                    and sc.create_time between #{createBeginTime} and #{createEndTime}
                </if>
                and sc.is_del = 0
            </where>
            <if test="pageSize != null and currRecord != null">
                limit #{currRecord},#{pageSize}
            </if>
        ) sc1
        LEFT JOIN qrcode_config qc on qc.id = sc1.qrcode_config_id
        left JOIN wx_appinfo wa ON wa.id = sc1.wx_appinfo_id
    </select>

    <select id="queryShoppersCodeListPageTotal" resultType="java.lang.Long">
        SELECT count(id) FROM `shoppers_code` sc
        <where>
            <if test="userName != null and userName != ''">
                and sc.user_name LIKE concat('%',#{userName},'%')
            </if>
            <if test="mallType != null and mallType != ''">
                and sc.mall_type LIKE concat('%',#{mallType},'%')
            </if>
            <if test="mallCode != null and mallCode != ''">
                and sc.mall_code like concat('%',#{mallCode},'%')
            </if>
            <if test="deptName != null and deptName != ''">
                and sc.dept_name like concat('%',#{deptName},'%')
            </if>
            <if test="userId != null and userId != ''">
                and sc.user_id like concat('%',#{userId},'%')
            </if>
            <if test="userName != null  and userName != ''">
                and sc.user_name like concat('%',#{userName},'%')
            </if>
            <if test="userPhone != null and userPhone != ''">
                and sc.user_phone like concat('%',#{userPhone},'%')
            </if>
            <if test="imgBeginTime != null and imgBeginTime != '' and imgEndTime != null and imgEndTime != ''">
                and sc.img_time between #{imgBeginTime} and #{imgEndTime}
            </if>
            <if test="enterpriseName != null and enterpriseName != ''">
                and sc.enterprise_name like concat('%',#{enterpriseName},'%')
            </if>
            <if test="createBeginTime != null and createBeginTime != '' and createEndTime != null and createEndTime != ''">
                and sc.create_time between #{createBeginTime} and #{createEndTime}
            </if>
            and sc.is_del = 0
        </where>

    </select>
    <select id="queryShoppersCodeById" resultType="com.winnerdt.modules.qrcode.entity.QRCodeInfoEntity">
        SELECT sc1.*
        ,qc.id qcId,qc.qrcode_height qcQrcodeHeight,qc.qrcode_width qcQrcodeWidth,qc.qrcode_font_size qcQrcodeFontSize,qc.qrcode_font_height qcQrcodeFontHeight,qc.qrcode_index_url qcQrcodeIndexUrl
        ,qc.qrcode_path qcQrcodePath,qc.is_del qcIsDel,qc.qrcode_config_name qcQrcodeConfigName,qc.remark qcRemark,qc.create_time qcCreateTime,qc.update_time qcUpdateTime
        ,wa.id waId,wa.appid waAppid,wa.secret waSecret,wa.name waName,wa.token waToken,wa.aeskey waAeskey,wa.access_token waAccessToken,wa.last_token_time waLastTokenTime,wa.expires_in waExpiresIn,wa.remark waRemark
        from (
        SELECT * FROM `shoppers_code` sc
        <where>
            <if test="userName != null and userName != ''">
                and sc.user_name LIKE concat('%',#{userName},'%')
            </if>
            <if test="mallType != null and mallType != ''">
                and sc.mall_type LIKE concat('%',#{mallType},'%')
            </if>
            <if test="mallCode != null and mallCode != ''">
                and sc.mall_code like concat('%',#{mallCode},'%')
            </if>
            <if test="deptName != null and deptName != ''">
                and sc.dept_name like concat('%',#{deptName},'%')
            </if>
            <if test="userId != null and userId != ''">
                and sc.user_id like concat('%',#{userId},'%')
            </if>
            <if test="userName != null  and userName != ''">
                and sc.user_name like concat('%',#{userName},'%')
            </if>
            <if test="userPhone != null and userPhone != ''">
                and sc.user_phone like concat('%',#{userPhone},'%')
            </if>
            <if test="imgBeginTime != null and imgBeginTime != '' and imgEndTime != null and imgEndTime != ''">
                and sc.img_time between #{imgBeginTime} and #{imgEndTime}
            </if>
            <if test="enterpriseName != null and enterpriseName != ''">
                and sc.enterprise_name like concat('%',#{enterpriseName},'%')
            </if>
            <if test="createBeginTime != null and createBeginTime != '' and createEndTime != null and createEndTime != ''">
                and sc.create_time between #{createBeginTime} and #{createEndTime}
            </if>
            and sc.id = #{id}
        </where>
        ) sc1
        LEFT JOIN qrcode_config qc on qc.id = sc1.qrcode_config_id
        left JOIN wx_appinfo wa ON wa.id = sc1.wx_appinfo_id
    </select>
</mapper>